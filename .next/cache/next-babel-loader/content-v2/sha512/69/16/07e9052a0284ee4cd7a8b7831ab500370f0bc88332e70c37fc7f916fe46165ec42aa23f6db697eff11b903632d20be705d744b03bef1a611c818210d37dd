{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/User/Desktop/REACT/mernChat/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"C:/Users/User/Desktop/REACT/mernChat/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:/Users/User/Desktop/REACT/mernChat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\REACT\\\\mernChat\\\\pages\\\\index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect, useRef, useState } from 'react';\nimport io from 'socket.io-client';\nimport axios from 'axios';\nimport baseUrl from '../utils/baseUrl';\nimport CreatePost from '../components/Post/CreatePost';\nimport CardPost from '../components/Post/CardPost';\nimport { Segment } from 'semantic-ui-react';\nimport { parseCookies } from 'nookies';\nimport { NoPosts } from '../components/Layout/NoData';\nimport { PostDeleteToastr } from '../components/Layout/Toastr';\nimport InfiniteScroll from 'react-infinite-scroll-component';\nimport { PlaceHolderPosts, EndMessage } from '../components/Layout/PlaceHolderGroup';\nimport cookie from 'js-cookie';\n\nfunction Index(_ref) {\n  _s();\n\n  var _this = this;\n\n  var user = _ref.user,\n      postsData = _ref.postsData,\n      errorLoading = _ref.errorLoading;\n\n  var _useState = useState(postsData || []),\n      posts = _useState[0],\n      setPosts = _useState[1];\n\n  var _useState2 = useState(false),\n      showToastr = _useState2[0],\n      setShowToastr = _useState2[1];\n\n  var _useState3 = useState(true),\n      hasMore = _useState3[0],\n      setHasMore = _useState3[1];\n\n  var _useState4 = useState(2),\n      pageNumber = _useState4[0],\n      setPageNumber = _useState4[1];\n\n  var socket = useRef();\n\n  var _useState5 = useState(null),\n      newMessageReceived = _useState5[0],\n      setNewMessageReceived = _useState5[1];\n\n  var _useState6 = useState(false),\n      newMessageModal = _useState6[0],\n      setNewMessageModal = _useState6[1];\n\n  useEffect(function () {\n    document.title = \"Welcome, \".concat(user.name.split(' ')[0]);\n\n    if (!socket.current) {\n      socket.current = io(baseUrl);\n    }\n\n    if (socket.current) {\n      socket.current.emit('join', {\n        userId: user._id\n      });\n    }\n  }, []);\n  useEffect(function () {\n    showToastr && setTimeout(function () {\n      return setShowToastr(false);\n    }, 3000);\n  }, [showToastr]);\n\n  var fetchDataOnScroll = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.get(\"\".concat(baseUrl, \"/api/posts\"), {\n                headers: {\n                  Authorization: cookie.get('token')\n                },\n                params: {\n                  pageNumber: pageNumber\n                }\n              });\n\n            case 3:\n              res = _context.sent;\n              if (res.data.length === 0) setHasMore(false);\n              setPosts(function (prev) {\n                return [].concat(_toConsumableArray(prev), _toConsumableArray(res.data));\n              });\n              setPageNumber(function (prev) {\n                return prev + 1;\n              });\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              alert('Error fetching Posts');\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9]]);\n    }));\n\n    return function fetchDataOnScroll() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (posts.length === 0 || errorLoading) return __jsx(NoPosts, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 50\n    }\n  });\n  return __jsx(React.Fragment, null, showToastr && __jsx(PostDeleteToastr, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 22\n    }\n  }), __jsx(Segment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, __jsx(CreatePost, {\n    user: user,\n    setPosts: setPosts,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }), __jsx(InfiniteScroll, {\n    hasMore: hasMore,\n    next: fetchDataOnScroll,\n    loader: __jsx(PlaceHolderPosts, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 19\n      }\n    }),\n    endMessage: __jsx(EndMessage, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 23\n      }\n    }),\n    dataLength: posts.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }\n  }, posts.map(function (post) {\n    return __jsx(CardPost, {\n      key: post._id,\n      post: post,\n      user: user,\n      setPosts: setPosts,\n      setShowToastr: setShowToastr,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 13\n      }\n    });\n  }))));\n}\n\n_s(Index, \"HCtTplKsgMAnsCKEkPpEf89R5S0=\");\n\n_c = Index;\n\nIndex.getInitialProps = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ctx) {\n    var _parseCookies, token, res;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _parseCookies = parseCookies(ctx), token = _parseCookies.token;\n            _context2.next = 4;\n            return axios.get(\"\".concat(baseUrl, \"/api/posts\"), {\n              headers: {\n                Authorization: token\n              },\n              params: {\n                pageNumber: 1\n              }\n            });\n\n          case 4:\n            res = _context2.sent;\n            return _context2.abrupt(\"return\", {\n              postsData: res.data\n            });\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](0);\n            return _context2.abrupt(\"return\", {\n              errorLoading: true\n            });\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[0, 8]]);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexport default Index;\n\nvar _c;\n\n$RefreshReg$(_c, \"Index\");","map":{"version":3,"sources":["C:/Users/User/Desktop/REACT/mernChat/pages/index.js"],"names":["React","useEffect","useRef","useState","io","axios","baseUrl","CreatePost","CardPost","Segment","parseCookies","NoPosts","PostDeleteToastr","InfiniteScroll","PlaceHolderPosts","EndMessage","cookie","Index","user","postsData","errorLoading","posts","setPosts","showToastr","setShowToastr","hasMore","setHasMore","pageNumber","setPageNumber","socket","newMessageReceived","setNewMessageReceived","newMessageModal","setNewMessageModal","document","title","name","split","current","emit","userId","_id","setTimeout","fetchDataOnScroll","get","headers","Authorization","params","res","data","length","prev","alert","map","post","getInitialProps","ctx","token"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport io from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport baseUrl from '../utils/baseUrl';\r\nimport CreatePost from '../components/Post/CreatePost';\r\nimport CardPost from '../components/Post/CardPost';\r\nimport { Segment } from 'semantic-ui-react';\r\nimport { parseCookies } from 'nookies';\r\nimport { NoPosts } from '../components/Layout/NoData';\r\nimport { PostDeleteToastr } from '../components/Layout/Toastr';\r\nimport InfiniteScroll from 'react-infinite-scroll-component';\r\nimport {\r\n  PlaceHolderPosts,\r\n  EndMessage,\r\n} from '../components/Layout/PlaceHolderGroup';\r\nimport cookie from 'js-cookie';\r\n\r\nfunction Index({ user, postsData, errorLoading }) {\r\n  const [posts, setPosts] = useState(postsData || []);\r\n  const [showToastr, setShowToastr] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n\r\n  const [pageNumber, setPageNumber] = useState(2);\r\n\r\n  const socket = useRef();\r\n\r\n  const [newMessageReceived, setNewMessageReceived] = useState(null);\r\n  const [newMessageModal, setNewMessageModal] = useState(false);\r\n\r\n  useEffect(() => {\r\n    document.title = `Welcome, ${user.name.split(' ')[0]}`;\r\n\r\n    if (!socket.current) {\r\n      socket.current = io(baseUrl);\r\n    }\r\n\r\n    if (socket.current) {\r\n      socket.current.emit('join', { userId: user._id });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    showToastr && setTimeout(() => setShowToastr(false), 3000);\r\n  }, [showToastr]);\r\n\r\n  const fetchDataOnScroll = async () => {\r\n    try {\r\n      const res = await axios.get(`${baseUrl}/api/posts`, {\r\n        headers: { Authorization: cookie.get('token') },\r\n        params: { pageNumber },\r\n      });\r\n\r\n      if (res.data.length === 0) setHasMore(false);\r\n\r\n      setPosts((prev) => [...prev, ...res.data]);\r\n      setPageNumber((prev) => prev + 1);\r\n    } catch (error) {\r\n      alert('Error fetching Posts');\r\n    }\r\n  };\r\n\r\n  if (posts.length === 0 || errorLoading) return <NoPosts />;\r\n\r\n  return (\r\n    <>\r\n      {showToastr && <PostDeleteToastr />}\r\n      <Segment>\r\n        <CreatePost user={user} setPosts={setPosts} />\r\n\r\n        <InfiniteScroll\r\n          hasMore={hasMore}\r\n          next={fetchDataOnScroll}\r\n          loader={<PlaceHolderPosts />}\r\n          endMessage={<EndMessage />}\r\n          dataLength={posts.length}\r\n        >\r\n          {posts.map((post) => (\r\n            <CardPost\r\n              key={post._id}\r\n              post={post}\r\n              user={user}\r\n              setPosts={setPosts}\r\n              setShowToastr={setShowToastr}\r\n            />\r\n          ))}\r\n        </InfiniteScroll>\r\n      </Segment>\r\n    </>\r\n  );\r\n}\r\n\r\nIndex.getInitialProps = async (ctx) => {\r\n  try {\r\n    const { token } = parseCookies(ctx);\r\n\r\n    const res = await axios.get(`${baseUrl}/api/posts`, {\r\n      headers: { Authorization: token },\r\n      params: { pageNumber: 1 },\r\n    });\r\n\r\n    return { postsData: res.data };\r\n  } catch (error) {\r\n    return { errorLoading: true };\r\n  }\r\n};\r\n\r\nexport default Index;\r\n"]},"metadata":{},"sourceType":"module"}